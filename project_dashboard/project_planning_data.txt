With 
log_hours_data AS (
    select project_assigntmid, sum(log_hour) AS log_hours from bpmsv2_dbo_project_tmactivity group by project_assigntmid
),
project_planning_data AS (
    select 
        pb.projectid, pb.project_breakupid, pf.project_fragmentationid, pfd.project_fragmentdtlsid, pt.areazoneid, pt.project_assigntmid, pt.project_assigntlid
        , pb.empid AS PDH_ID, eu.fullname AS PDH_Name, pb.hours AS brkp_hours
        , pf.type AS fragmentation_type, pf.bhour as fragment_hours
        , pfd.details AS fragmentationdtls_type, pfd.hour AS fragment_dtls_hours
        , CAST(pfd.entrydate as date) AS fragment_dtls_entrydate
        , pt.entryby AS PM_ID, eu1.fullname AS PM_Name, mw.emp_worktype as worktype, pz.floorid, pt.hour AS areazone_hours, CAST(pt.startdate as date) AS area_startdate
        , cast(pt.enddate as date) AS area_enddate
        , pz.areazone AS areazone_type, pz.areacovered, pz.entryby, pz.areaweightageid, cast(pz.entrydate as date) AS areazone_entrydate
        -- logged hours details
        , pta.log_hours AS tm_log_hours
    from "bpmsv2_dbo_project_breakup" pb 
    left join bpmsv2_dbo_project_fragmentation pf ON pb.project_breakupid = pf.projectbrekupid
    left join bpmsv2_dbo_project_fragmentationdtls pfd ON pf.project_fragmentationid = pfd.project_fragmentationid
    left join bpmsv2_dbo_project_tm pt ON pb.project_breakupid = pt.projectbrkupid
    left join view_master_worktype mw ON pt.worktypeid = mw.worktypeid
    left join bpmsv2_dbo_project_areazone pz ON pt.areazoneid = pz.areazoneid
    left join log_hours_data pta ON pt.project_assigntmid = pta.project_assigntmid
    -- PDH Name
    left join bpmsv2_dbo_employee_userdetails eu ON pb.empid = eu.empid
    -- PM Name
    left join bpmsv2_dbo_employee_userdetails eu1 ON pt.entryby = eu1.empid
    -- where pb.projectid = 77793
)

select * from project_planning_data where projectid = 77793